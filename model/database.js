require("dotenv").config();
const mysql = require("mysql");

const DB_HOST = process.env.DB_HOST;
const DB_USER = process.env.DB_USER;
const DB_PASS = process.env.DB_PASS;
const DB_NAME = process.env.DB_NAME;

const con = mysql.createConnection({
  host: DB_HOST || "127.0.0.1",
  user: DB_USER || "root",
  password: DB_PASS,
  database: DB_NAME || "mvp",
  multipleStatements: true
});

con.connect(function(err) {
  if (err) throw err;
  console.log("Connected!");

let sql = "DROP TABLE if exists quiz; DROP TABLE if exists answers; DROP TABLE if exists useranswers;  DROP TABLE if exists users; DROP TABLE if exists concerns; DROP TABLE if exists concernsIngredients; DROP TABLE if exists ingredients; CREATE TABLE quiz(id INT NOT NULL AUTO_INCREMENT, question VARCHAR(255) not null, PRIMARY KEY (id)); CREATE TABLE answers(id INT NOT NULL AUTO_INCREMENT, answer VARCHAR(255), question_ID INT DEFAULT 0 NOT NULL, PRIMARY KEY (id)); CREATE TABLE concerns(id INT NOT NULL AUTO_INCREMENT, concern VARCHAR(255), answer_ID INT DEFAULT 0 NOT NULL, PRIMARY KEY (id)); CREATE TABLE concernsIngredients (concern_ID INT DEFAULT 0 NOT NULL, ingredient_ID INT DEFAULT 0 NOT NULL); CREATE TABLE ingredients(id INT NOT NULL AUTO_INCREMENT, name VARCHAR(255), altname VARCHAR(255), role VARCHAR(255),  description VARCHAR(255),  details VARCHAR(255), rating VARCHAR(255), PRIMARY KEY (id)); INSERT INTO quiz (id, question) VALUES (1, 'How would you describe your skin type?'); INSERT INTO quiz (id, question) VALUES (2, 'Do you have sensitive skin?'); INSERT INTO quiz (id, question) VALUES (3, 'What are your main concerns? Select up to 3.'); INSERT INTO quiz (id, question) VALUES (4, 'What about your eye area?'); INSERT INTO quiz (id, question) VALUES (5, 'What age group do you belong to?'); INSERT INTO answers VALUES (1, 'Dry', 1); INSERT INTO answers VALUES (2, 'Balanced', 1); INSERT INTO answers VALUES (3, 'Oily', 1); INSERT INTO answers VALUES (4, 'Combination', 1); INSERT INTO answers VALUES (5, 'Signs of congestion', 3); INSERT INTO answers VALUES (6, 'Dryness/ dehydration', 3); INSERT INTO answers VALUES (7, 'Dullness', 3); INSERT INTO answers VALUES (8, 'Signs of aging', 3); INSERT INTO answers VALUES (9, 'Irregular skin texture', 3); INSERT INTO answers VALUES (10, 'Uneven skin tone', 3); INSERT INTO answers VALUES (11, 'Active acne breakouts', 3); INSERT INTO answers VALUES (12, 'Post acne scars', 3); INSERT INTO answers VALUES (13, 'Under 20', 5); INSERT INTO answers VALUES (14, '20 - 29', 5); INSERT INTO answers VALUES (15, '30 - 39', 5); INSERT INTO answers VALUES (16, '40 - 49', 5); INSERT INTO answers VALUES (17, '50+', 5); INSERT INTO answers VALUES (18, 'Prefer not to say', 5); INSERT INTO answers VALUES (19, 'Not at all', 2); INSERT INTO answers VALUES (20, 'Sometimes', 2); INSERT INTO answers VALUES (21, 'Yes', 2); INSERT INTO answers VALUES (22, 'Not sure', 2); INSERT INTO answers VALUES (23, 'Dark circles', 4); INSERT INTO answers VALUES (24, 'Puffiness', 4); INSERT INTO answers VALUES (25, 'Fine lines', 4); INSERT INTO answers VALUES (26, 'All three', 4); INSERT INTO answers VALUES (27, 'None', 4);INSERT INTO concerns VALUES (1, 'dry skin', 1); INSERT INTO concerns VALUES (2, 'oily skin', 3); INSERT INTO concerns VALUES (3, 'combination skin', 4); INSERT INTO concerns VALUES (4, 'white heads/black heads', 5); INSERT INTO concerns VALUES (5, 'dehydrated skin', 6); INSERT INTO concerns VALUES (6, 'dull skin', 7); INSERT INTO concerns VALUES (7, 'mature skin', 8); INSERT INTO concerns VALUES (8, 'accumulated dead skin', 9); INSERT INTO concerns VALUES (9, 'sun damage', 10); INSERT INTO concerns VALUES (10, 'acne', 11); INSERT INTO concerns VALUES (11, 'acne scarring', 12); INSERT INTO concerns VALUES (12, 'mature skin', 17); INSERT INTO concerns VALUES (13, 'sensitive skin', 20); INSERT INTO concerns VALUES (14, 'sensitive skin', 21); INSERT INTO concerns VALUES (15, 'sensitive skin', 22);  INSERT INTO concerns VALUES (16, 'under eye dark circles', 23); INSERT INTO concerns VALUES (17, 'under eye puffiness', 24); INSERT INTO concerns VALUES (18, 'mature skin', 25); INSERT INTO concerns VALUES (19, 'mature skin', 26); INSERT INTO concerns VALUES (20, 'under eye dark circles', 26); INSERT INTO concerns VALUES (21, 'under eye puffiness', 26); INSERT INTO ingredients VALUE (1, 'Water', 'aqua', 'solvent', 'water', 'Good old water, aka H2O. The most common skincare ingredient of all. It is mainly a solvent for ingredients that do not like to dissolve in oils but rather in water', null); INSERT INTO ingredients VALUE (2, 'Glucose', 'Dextrosum/ Glucosum', 'humectant', 'Humectant is the official name for a moisturizer ingredient that helps your skin to cling onto water and hold onto it so that your skin feels nicely moisturized.', 'A fancy name for sugar. Luckily when you put it on your skin it is good for you not like when you eat it. It has water-binding properties, which means that it helps to keep your skin nice and hydrated.', 'goodie'); INSERT INTO ingredients VALUE (3, 'Niacinamide', 'vitamin B3, nicotinamide', 'cell-communicating ingredient, skin brightening, anti-acne, moisturizer/humectant, smoothing', 'A multi-functional skincare superstar with several proven benefits for the skin. Great anti-aging, wrinkle smoothing ingredient. Can help to improve several skin conditions including acne, rosacea, and atopic dermatitis.', 'Niacinamide, is a real skincare superstar that has had so many studies and has so many skin benefits. It is an odorless water-soluble vitamin that usually comes in white powder form. The version used in cosmetics is produced exclusively synthetically.', 'superstar'); INSERT INTO ingredients VALUE (4, 'Retinol','Vitamin A, Form of Retinoids', 'cell-communicating ingredient', 'Ingredients that signal to our skin cells to behave better. The most famous example is retinol or peptides.', 'Retinol is probably the most proven anti-aging ingredient available OTC. It makes skin less wrinkled, smoother, firmer and tighter. It might also be helpful for acne prone skin and makes the pores produce less sebum. Do not use whilst pregnant.', 'superstar'); INSERT INTO ingredients VALUE (5, 'Ascorbic Acid', 'Vitamin C, L-ascorbic acid', 'antioxidant, skin brightening, buffering', 'Works best between a concentration of 5-20%. Boosts the skin collagen production. Fades pigmentation and brown spots. If used under sunscreen it boosts its UV protection. Potent Vit. C serums might cause a slight tingling on sensitive skin.', 'Serious performance, A-list superstar but at the same time shows some major divaish behaviour.  Scientists managed to figure out only in the 1930s what Vitamin C is.', 'superstar'); INSERT INTO ingredients VALUE (6, 'Hyaluronic Acid', null, 'skin-identical ingredient, moisturizer/humectant', 'It is naturally in our skin and behaves there like a sponge. It can bind up to 1000 times its own weight in water. It is a big molecule from repeated subunits (polymer) so different molecular weight versions exist.', 'Hyaluronic acid (HA) and its various forms are the current IT-moisturizers. It is the most dominant, and most important molecule in the liquidy stuff between our skin cells. A 70 kg adult has about 15 g of HA in her body, and half of it is in the skin.', 'goodie'); INSERT INTO concernsIngredients VALUE(1, 2); INSERT INTO concernsIngredients VALUE(1, 3); INSERT INTO concernsIngredients VALUE(1, 6); INSERT INTO concernsIngredients VALUE(2, 3); INSERT INTO concernsIngredients VALUE(3, 3); INSERT INTO concernsIngredients VALUE(4, 3); INSERT INTO concernsIngredients VALUE(4, 4); INSERT INTO concernsIngredients VALUE(4, 5); INSERT INTO concernsIngredients VALUE(5, 2); INSERT INTO concernsIngredients VALUE(5, 3); INSERT INTO concernsIngredients VALUE(5, 6); INSERT INTO concernsIngredients VALUE(6, 3); INSERT INTO concernsIngredients VALUE(6, 5); INSERT INTO concernsIngredients VALUE(7, 4); INSERT INTO concernsIngredients VALUE(8, 3); INSERT INTO concernsIngredients VALUE(8, 4); INSERT INTO concernsIngredients VALUE(8, 5); INSERT INTO concernsIngredients VALUE(9, 5); INSERT INTO concernsIngredients VALUE(10, 3); INSERT INTO concernsIngredients VALUE(10, 4); INSERT INTO concernsIngredients VALUE(11, 4); INSERT INTO concernsIngredients VALUE(11, 3); INSERT INTO concernsIngredients VALUE(11, 5); INSERT INTO concernsIngredients VALUE(12, 4); INSERT INTO concernsIngredients VALUE(13, 3); INSERT INTO concernsIngredients VALUE(14, 3); INSERT INTO concernsIngredients VALUE(15, 3); INSERT INTO concernsIngredients VALUE(16, 3); INSERT INTO concernsIngredients VALUE(16, 4); INSERT INTO concernsIngredients VALUE(16, 5); INSERT INTO concernsIngredients VALUE(17, 3); INSERT INTO concernsIngredients VALUE(17, 4); INSERT INTO concernsIngredients VALUE(18, 4); INSERT INTO concernsIngredients VALUE(19, 4); INSERT INTO concernsIngredients VALUE(20, 3); INSERT INTO concernsIngredients VALUE(20, 4); INSERT INTO concernsIngredients VALUE(20, 5); INSERT INTO concernsIngredients VALUE(21, 3); INSERT INTO concernsIngredients VALUE(21, 4);  CREATE TABLE `users` ( `id` int NOT NULL AUTO_INCREMENT, `user_name` varchar(10) NOT NULL, `password` varchar(15) NOT NULL, `name` varchar(100) DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `user_id_UNIQUE` (`id`), UNIQUE KEY `user_name_UNIQUE` (`user_name`) ) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci; CREATE TABLE `useranswers` ( `id` int NOT NULL AUTO_INCREMENT, `user_ID` int NOT NULL, `answer_ID` int NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `id_UNIQUE` (`id`), KEY `id_idx` (`answer_ID`), KEY `user_idx` (`user_ID`), CONSTRAINT `aid` FOREIGN KEY (`answer_ID`) REFERENCES `answers` (`id`), CONSTRAINT `user` FOREIGN KEY (`user_ID`) REFERENCES `users` (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;";  


con.query(sql, function(err, result) {
    if (err) throw err;
    console.log("Tables creation was successful!");

    console.log("Closing...");
  });

  con.end();
});